<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layoutNavBar}">
<head>
    <title>Gestión de Documentos</title>
    <th:block layout:fragment="styles">
        <link rel="stylesheet" th:href="@{/css/app.css}"/>
        <link rel="stylesheet" th:href="@{/css/documentacion.css}"/>
    </th:block>
</head>

<body>
<div layout:fragment="content" class="task-container">
    <h1 class="task-title">Gestión de Documentación</h1>

    <!-- Botón justo debajo del título -->
    <div class="mb-4">
        <a th:href="@{/gestion-proyectos}" class="btn btn-primary">
            Gestionar proyectos
        </a>
    </div>

    <!-- Sección: Documentación General -->
    <div class="doc-section doc-general mb-5">
        <h2 class="doc-title">Documentación General</h2>
        <div th:if="${proyectosGenerales != null && !proyectosGenerales.isEmpty()}">
            <ul class="list-group">
                <li th:each="proyecto : ${proyectosGenerales}" class="list-group-item">
                    <strong th:text="${proyecto.nombre}">Nombre Proyecto</strong><br>
                    <span th:text="${proyecto.descripcion}">Descripción</span><br>

                    <!-- Botón para subir documentos -->
                    <form th:action="@{/documentacion/subir}" method="post" enctype="multipart/form-data" class="mt-2">
                        <input type="hidden" th:name="idProyecto" th:value="${proyecto.id}" />
                        <input type="file" name="archivo" required>
                        <button type="submit" class="btn btn-success btn-sm mt-2">Subir Documento</button>
                    </form>

                    <!-- Botones de Descargar y Borrar -->
                    <div class="mt-2">
                        <a th:href="@{/documentacion/descargar/{id}(id=${proyecto.id})}" class="btn btn-primary btn-sm">Descargar</a>
                        <form th:action="@{/documentacion/borrar}" method="post" class="d-inline">
                            <input type="hidden" th:name="idProyecto" th:value="${proyecto.id}" />
                            <button type="submit" class="btn btn-danger btn-sm">Borrar</button>
                        </form>
                    </div>
                </li>
            </ul>
        </div>
        <div th:if="${proyectosGenerales == null || proyectosGenerales.isEmpty()}">
            <p>No hay proyectos generales disponibles.</p>
        </div>
    </div>

    <!-- Sección: Mis Proyectos -->
    <div class="doc-section doc-personal">
        <h2 class="doc-title">Mis Proyectos</h2>
        <div th:if="${misProyectos != null && !misProyectos.isEmpty()}">
            <ul class="list-group">
                <li th:each="proyecto : ${proyectosGenerales}" class="list-group-item">
                    <strong th:text="${proyecto.nombre}">Nombre Proyecto</strong><br>
                    <span th:text="${proyecto.descripcion}">Descripción</span><br>

                    <!-- Depuración: Mostrar el ID del proyecto -->
                    <span th:text="'ID del Proyecto: ' + ${proyecto.id}" class="text-muted"></span><br>

                    <!-- Botón para subir documentos -->
                    <form th:action="@{/documentacion/subir}" method="post" enctype="multipart/form-data" class="mt-2">
                        <input type="hidden" th:name="idProyecto" th:value="${proyecto.id}" />
                        <input type="file" name="archivo" required>
                        <button type="submit" class="btn btn-success btn-sm mt-2">Subir Documento</button>
                    </form>

                    <!-- Botones de Descargar y Borrar -->
                    <div class="mt-2">
                        <a th:href="@{/documentacion/descargar/{id}(id=${proyecto.id})}" class="btn btn-primary btn-sm">Descargar</a>
                        <form th:action="@{/documentacion/borrar}" method="post" class="d-inline">
                            <input type="hidden" th:name="idProyecto" th:value="${proyecto.id}" />
                            <button type="submit" class="btn btn-danger btn-sm">Borrar</button>
                        </form>
                    </div>
                </li>
            </ul>
        </div>
        <div th:if="${misProyectos == null || misProyectos.isEmpty()}">
            <p>No tienes proyectos asignados.</p>
        </div>
    </div>
</div>

</body>
</html>